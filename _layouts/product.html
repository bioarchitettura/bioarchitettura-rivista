<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'it' }}">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="{{ page.excerpt | default: page.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">
    
    <title>{{ page.title | escape }} | {{ site.title | escape }}</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS -->
    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
    <link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">
    
    <!-- Meta tags -->
    <meta property="og:title" content="{{ page.title | escape }}">
    <meta property="og:description" content="{{ page.excerpt | default: page.description | strip_html | normalize_whitespace | truncate: 300 | escape }}">
    <meta property="og:url" content="{{ page.url | absolute_url }}">
    <meta property="og:site_name" content="{{ site.title | escape }}">
    <meta property="og:type" content="product">
    {% if page.image %}
    <meta property="og:image" content="{{ page.image | absolute_url }}">
    {% endif %}
    
    <!-- Product Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org/",
      "@type": "Product",
      "name": "{{ page.title }}",
      "description": "{{ page.description }}",
      {% if page.image %}"image": "{{ page.image | absolute_url }}",{% endif %}
      {% if page.rating %}"aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "{{ page.rating }}",
        "reviewCount": "{{ page.reviews_count }}"
      },{% endif %}
      "offers": {
        "@type": "Offer",
        "price": "{{ page.price }}",
        "priceCurrency": "{{ page.currency }}",
        "availability": "https://schema.org/InStock"
      }
    }
    </script>
</head>

<body class="product-page">
    <!-- Language Selection Bar -->
    <div id="language-bar" class="language-bar">
        <div class="language-container">
            <div class="language-selector">
                <button class="lang-btn active" data-lang="it">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAyNCAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjE4IiBmaWxsPSIjMDA5MjQ2Ii8+CjxyZWN0IHdpZHRoPSIyNCIgaGVpZ2h0PSIxMiIgZmlsbD0iI0ZGRkZGRiIvPgo8cmVjdCB3aWR0aD0iMjQiIGhlaWdodD0iNiIgZmlsbD0iI0NFMUEyNiIvPgo8L3N2Zz4K" alt="IT"> IT
                </button>
                <button class="lang-btn" data-lang="en">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAyNCAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjE4IiBmaWxsPSIjMDEyMTY5Ii8+CjxwYXRoIGQ9Ik0wIDBoMjR2MkgweiIgZmlsbD0iI0ZGRiIvPgo8cGF0aCBkPSJNMCA0aDI0djJIMHoiIGZpbGw9IiNDRTFBMjYiLz4KPHA+dGggZD0iTTAgOGgyNHYySDB6IiBmaWxsPSIjRkZGIi8+CjxwYXRoIGQ9Ik0wIDEyaDI0djJIMHoiIGZpbGw9IiNDRTFBMjYiLz4KPHA+dGggZD0iTTAgMTZoMjR2MkgweiIgZmlsbD0iI0ZGRiIvPgo8L3N2Zz4K" alt="EN"> EN
                </button>
                <button class="lang-btn" data-lang="de">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAyNCAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjYiIGZpbGw9IiMwMDAiLz4KPHJlY3QgeT0iNiIgd2lkdGg9IjI0IiBoZWlnaHQ9IjYiIGZpbGw9IiNEQzE0M0MiLz4KPHJlY3QgeT0iMTIiIHdpZHRoPSIyNCIgaGVpZ2h0PSI2IiBmaWxsPSIjRkZDRTAwIi8+Cjwvc3ZnPgo=" alt="DE"> DE
                </button>
                <button class="lang-btn" data-lang="fr">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAyNCAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgiIGhlaWdodD0iMTgiIGZpbGw9IiMwMDJBOEYiLz4KPHJlY3QgeD0iOCIgd2lkdGg9IjgiIGhlaWdodD0iMTgiIGZpbGw9IiNGRkYiLz4KPHJlY3QgeD0iMTYiIHdpZHRoPSI4IiBoZWlnaHQ9IjE4IiBmaWxsPSIjRUQyOTM5Ii8+Cjwvc3ZnPgo=" alt="FR"> FR
                </button>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="{{ '/' | relative_url }}" class="nav-logo">
                    <h1>{{ site.title_short | default: "Bioarchitettura" }}</h1>
                </a>
            </div>

            <!-- Desktop Navigation -->
            <ul class="nav-menu" id="nav-menu">
                <li class="nav-item">
                    <a href="{{ '/' | relative_url }}" class="nav-link">
                        <span data-translate="nav.home">Home</span>
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a href="{{ '/rivista/' | relative_url }}" class="nav-link dropdown-toggle">
                        <span data-translate="nav.magazine">Rivista</span>
                    </a>
                    <div class="dropdown-menu">
                        <a href="{{ '/rivista/archivio/' | relative_url }}" class="dropdown-item" data-translate="nav.archive">Archivio</a>
                        <a href="{{ '/rivista/abbonamenti/' | relative_url }}" class="dropdown-item" data-translate="nav.subscription">Abbonamenti</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a href="{{ '/shop/' | relative_url }}" class="nav-link dropdown-toggle">
                        <span data-translate="nav.shop">Shop</span>
                    </a>
                    <div class="dropdown-menu">
                        <a href="{{ '/shop/ebooks/' | relative_url }}" class="dropdown-item" data-translate="nav.ebooks">E-books</a>
                        <a href="{{ '/shop/corsi/' | relative_url }}" class="dropdown-item" data-translate="nav.courses">Corsi</a>
                        <a href="{{ '/shop/webinar/' | relative_url }}" class="dropdown-item" data-translate="nav.webinars">Webinar</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="{{ '/chi-siamo/' | relative_url }}" class="nav-link">
                        <span data-translate="nav.about">Chi Siamo</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{{ '/contatti/' | relative_url }}" class="nav-link">
                        <span data-translate="nav.contact">Contatti</span>
                    </a>
                </li>
                <li class="nav-item">
                    <button class="cart-btn" id="cart-btn" title="Carrello">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="9" cy="21" r="1"></circle>
                            <circle cx="20" cy="21" r="1"></circle>
                            <path d="m1 1 4 4 16 2-3 12H7L5 3H2"></path>
                        </svg>
                        <span class="cart-count" id="cart-count">0</span>
                    </button>
                </li>
            </ul>

            <!-- Mobile Navigation Toggle -->
            <div class="nav-toggle" id="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Product Hero -->
        <section class="product-hero">
            <div class="container">
                <div class="product-hero-content">
                    <div class="product-images">
                        <div class="main-image">
                            <img src="{{ page.image }}" alt="{{ page.title }}" id="main-product-image">
                        </div>
                        {% if page.gallery and page.gallery.size > 1 %}
                        <div class="gallery-thumbnails">
                            {% for image in page.gallery %}
                            <img src="{{ image }}" alt="{{ page.title }}" class="thumbnail{% if forloop.first %} active{% endif %}" data-main-image="{{ image }}">
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="product-info">
                        <div class="product-category">{{ page.category | capitalize }}</div>
                        <h1 class="product-title">{{ page.title }}</h1>
                        
                        {% if page.rating %}
                        <div class="product-rating">
                            <div class="stars">
                                {% for i in (1..5) %}
                                    {% if i <= page.rating %}
                                        <span class="star filled">★</span>
                                    {% else %}
                                        <span class="star">☆</span>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <span class="rating-text">{{ page.rating }}/5 ({{ page.reviews_count }} recensioni)</span>
                        </div>
                        {% endif %}
                        
                        <p class="product-description">{{ page.description }}</p>
                        
                        <div class="product-price">
                            <span class="current-price">€{{ page.price }}</span>
                        </div>
                        
                        <div class="product-actions">
                            <button class="btn btn-primary btn-lg add-to-cart" data-product-id="{{ page.slug }}">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="9" cy="21" r="1"></circle>
                                    <circle cx="20" cy="21" r="1"></circle>
                                    <path d="m1 1 4 4 16 2-3 12H7L5 3H2"></path>
                                </svg>
                                Aggiungi al Carrello
                            </button>
                        </div>
                        
                        {% if page.tags %}
                        <div class="product-tags">
                            {% for tag in page.tags %}
                            <span class="tag">{{ tag }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </section>

        <!-- Product Details -->
        <section class="product-details">
            <div class="container">
                <div class="details-tabs">
                    <button class="tab-btn active" data-tab="description">Descrizione</button>
                    <button class="tab-btn" data-tab="details">Dettagli</button>
                    {% if page.reviews_count > 0 %}<button class="tab-btn" data-tab="reviews">Recensioni</button>{% endif %}
                </div>
                
                <div class="details-content">
                    <div class="tab-content active" id="description">
                        <div class="product-content">
                            {{ content }}
                        </div>
                    </div>
                    
                    <div class="tab-content" id="details">
                        <div class="product-specs">
                            {% if page.author %}<p><strong>Autore:</strong> {{ page.author }}</p>{% endif %}
                            {% if page.format %}<p><strong>Formato:</strong> {{ page.format }}</p>{% endif %}
                            {% if page.language %}<p><strong>Lingua:</strong> {{ page.language }}</p>{% endif %}
                            {% if page.duration %}<p><strong>Durata:</strong> {{ page.duration }}</p>{% endif %}
                            {% if page.pages %}<p><strong>Pagine:</strong> {{ page.pages }}</p>{% endif %}
                            {% if page.requirements %}<p><strong>Requisiti:</strong> {{ page.requirements }}</p>{% endif %}
                        </div>
                    </div>
                    
                    {% if page.reviews_count > 0 %}
                    <div class="tab-content" id="reviews">
                        <div class="reviews-section">
                            <p>Le recensioni saranno disponibili prossimamente.</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3 data-translate="footer.foundation">Fondazione</h3>
                    <p>{{ site.foundation.full_name }}</p>
                    <p data-translate="footer.status">{{ site.foundation.legal_status }}</p>
                </div>
                
                <div class="footer-section">
                    <h3 data-translate="footer.contact">Contatti</h3>
                    <p>
                        <strong data-translate="footer.phone">Telefono:</strong> 
                        <a href="tel:{{ site.contact.phone }}">{{ site.contact.phone }}</a>
                    </p>
                    <p>
                        <strong>Email:</strong> 
                        <a href="mailto:{{ site.contact.email }}">{{ site.contact.email }}</a>
                    </p>
                    <p>
                        <strong data-translate="footer.address">Indirizzo:</strong><br>
                        {{ site.contact.address }}
                    </p>
                </div>
                
                <div class="footer-section">
                    <h3 data-translate="footer.quick_links">Link Rapidi</h3>
                    <ul>
                        <li><a href="{{ '/rivista/' | relative_url }}" data-translate="footer.magazine">Rivista</a></li>
                        <li><a href="{{ '/shop/' | relative_url }}" data-translate="footer.shop">Shop</a></li>
                        <li><a href="{{ '/privacy/' | relative_url }}" data-translate="footer.privacy">Privacy</a></li>
                        <li><a href="{{ '/terms/' | relative_url }}" data-translate="footer.terms">Termini</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3 data-translate="footer.newsletter">Newsletter</h3>
                    <form class="newsletter-form" id="newsletter-form">
                        <input type="email" placeholder="La tua email" data-translate-placeholder="footer.email_placeholder" required>
                        <button type="submit" data-translate="footer.subscribe">Iscriviti</button>
                    </form>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; {{ 'now' | date: "%Y" }} {{ site.title }}. <span data-translate="footer.rights">Tutti i diritti riservati.</span></p>
            </div>
        </div>
    </footer>

    <!-- Shopping Cart Modal -->
    <div id="cart-modal" class="cart-modal">
        <div class="cart-content">
            <div class="cart-header">
                <h2 data-translate="cart.title">Carrello</h2>
                <button class="cart-close" id="cart-close">&times;</button>
            </div>
            <div class="cart-body" id="cart-items">
                <p class="empty-cart" data-translate="cart.empty">Il carrello è vuoto</p>
            </div>
            <div class="cart-footer">
                <div class="cart-total">
                    <strong data-translate="cart.total">Totale: </strong>
                    <span id="cart-total">€0.00</span>
                </div>
                <div class="cart-actions">
                    <button class="btn btn-secondary" id="clear-cart" data-translate="cart.clear">Svuota</button>
                    <button class="btn btn-primary" id="checkout-btn" data-translate="cart.checkout">Checkout</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="notification-container"></div>

    <!-- JavaScript -->
    <script src="{{ '/assets/js/main.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/shop.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/translation.js' | relative_url }}"></script>
    
    <script>
    // Product page specific functionality
    document.addEventListener('DOMContentLoaded', function() {
        // Gallery functionality
        const thumbnails = document.querySelectorAll('.thumbnail');
        const mainImage = document.getElementById('main-product-image');
        
        thumbnails.forEach(thumb => {
            thumb.addEventListener('click', function() {
                // Remove active class from all thumbnails
                thumbnails.forEach(t => t.classList.remove('active'));
                // Add active class to clicked thumbnail
                this.classList.add('active');
                // Update main image
                mainImage.src = this.dataset.mainImage;
            });
        });
        
        // Tabs functionality
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const targetTab = this.dataset.tab;
                
                // Remove active class from all tabs and contents
                tabBtns.forEach(b => b.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding content
                this.classList.add('active');
                document.getElementById(targetTab).classList.add('active');
            });
        });
        
        // Add to cart functionality
        const addToCartBtn = document.querySelector('.add-to-cart');
        if (addToCartBtn) {
            addToCartBtn.addEventListener('click', function() {
                const productId = this.dataset.productId;
                if (window.cart) {
                    window.cart.addItem(productId);
                }
            });
        }
    });
    </script>
</body>
</html>